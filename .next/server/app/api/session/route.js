(()=>{var e={};e.id=754,e.ids=[754],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},7521:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>w,routeModule:()=>d,serverHooks:()=>m,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>l});var n={};r.r(n),r.d(n,{POST:()=>c});var a=r(2706),s=r(8203),i=r(5994),o=r(9187),u=r(5549);async function c(e){try{let{name:t}=await e.json();if(!t||"string"!=typeof t)return o.NextResponse.json({error:"Введите имя, чтобы начать."},{status:400});let r=t.trim().slice(0,32);if(!r)return o.NextResponse.json({error:"Имя не может быть пустым."},{status:400});let n=await (0,u.cK)(r);return o.NextResponse.json({conversation:n})}catch(e){return console.error("Session create error",e),o.NextResponse.json({error:"Не удалось создать сессию."},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/session/route",pathname:"/api/session",filename:"route",bundlePath:"app/api/session/route"},resolvedPagePath:"C:\\Users\\user\\Desktop\\HuilaAI\\src\\app\\api\\session\\route.ts",nextConfigOutput:"",userland:n}),{workAsyncStorage:p,workUnitAsyncStorage:l,serverHooks:m}=d;function w(){return(0,i.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:l})}},6487:()=>{},8335:()=>{},5549:(e,t,r)=>{"use strict";r.d(t,{Qv:()=>c,cK:()=>u,QL:()=>o,Zn:()=>d,lB:()=>l,G5:()=>p});let n=require("@prisma/client"),a=globalThis.prisma??new n.PrismaClient({log:["error"]});function s(e){if(!e)throw Error("Conversation is missing");return{id:e.id,name:e.name,createdAt:e.createdAt.toISOString(),manualMode:e.manualMode,waitingForManual:e.waitingForManual,messages:e.messages.map(e=>({id:e.id,sender:e.sender,text:e.text,createdAt:e.createdAt.toISOString(),via:e.via}))}}async function i(e){let t=await o(e);if(!t)throw Error("Conversation not found");return t}async function o(e){let t=await a.conversation.findUnique({where:{id:e},include:{messages:{orderBy:{createdAt:"asc"}}}});return t?s(t):null}async function u(e){return s(await a.conversation.create({data:{name:e},include:{messages:!0}}))}async function c(e,t){return await a.message.create({data:{id:t.id,conversationId:e,sender:t.sender,text:t.text,via:t.via,createdAt:new Date(t.createdAt)}}),i(e)}async function d(){return(await a.conversation.findMany({orderBy:{createdAt:"desc"},include:{messages:{orderBy:{createdAt:"asc"}}}})).map(s)}async function p(e,t){return await a.conversation.update({where:{id:e},data:{manualMode:t,...t?{}:{waitingForManual:!1}}}),i(e)}async function l(e,t){return await a.conversation.update({where:{id:e},data:{waitingForManual:t}}),i(e)}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[989,452],()=>r(7521));module.exports=n})();