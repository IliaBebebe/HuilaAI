(()=>{var e={};e.id=506,e.ids=[506],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},7248:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>w,routeModule:()=>p,serverHooks:()=>v,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>m});var a={};t.r(a),t.d(a,{POST:()=>c});var n=t(2706),s=t(8203),i=t(5994),o=t(9187),u=t(7702),d=t(5549);async function c(e){try{let{password:r,conversationId:t,text:a}=await e.json();if(!(0,u.u)(r))return o.NextResponse.json({error:"Нет доступа"},{status:401});if(!t||!a)return o.NextResponse.json({error:"Неверные параметры"},{status:400});let n={id:crypto.randomUUID(),sender:"admin",text:a.slice(0,2e3),createdAt:new Date().toISOString(),via:"manual"},s=await (0,d.Qv)(t,n);return await (0,d.lB)(t,!1),o.NextResponse.json({conversation:s,reply:n})}catch(e){return console.error("Manual reply error",e),o.NextResponse.json({error:"Не удалось отправить ручной ответ"},{status:500})}}let p=new n.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/admin/reply/route",pathname:"/api/admin/reply",filename:"route",bundlePath:"app/api/admin/reply/route"},resolvedPagePath:"C:\\Users\\user\\Desktop\\HuilaAI\\src\\app\\api\\admin\\reply\\route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:l,workUnitAsyncStorage:m,serverHooks:v}=p;function w(){return(0,i.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:m})}},6487:()=>{},8335:()=>{},7702:(e,r,t)=>{"use strict";t.d(r,{u:()=>n});let a=process.env.ADMIN_PASSWORD&&process.env.ADMIN_PASSWORD.length>0?process.env.ADMIN_PASSWORD:"Жопа";function n(e){return e===a}},5549:(e,r,t)=>{"use strict";t.d(r,{Qv:()=>d,cK:()=>u,QL:()=>o,Zn:()=>c,lB:()=>l,G5:()=>p});let a=require("@prisma/client"),n=globalThis.prisma??new a.PrismaClient({log:["error"]});function s(e){if(!e)throw Error("Conversation is missing");return{id:e.id,name:e.name,createdAt:e.createdAt.toISOString(),manualMode:e.manualMode,waitingForManual:e.waitingForManual,messages:e.messages.map(e=>({id:e.id,sender:e.sender,text:e.text,createdAt:e.createdAt.toISOString(),via:e.via}))}}async function i(e){let r=await o(e);if(!r)throw Error("Conversation not found");return r}async function o(e){let r=await n.conversation.findUnique({where:{id:e},include:{messages:{orderBy:{createdAt:"asc"}}}});return r?s(r):null}async function u(e){return s(await n.conversation.create({data:{name:e},include:{messages:!0}}))}async function d(e,r){return await n.message.create({data:{id:r.id,conversationId:e,sender:r.sender,text:r.text,via:r.via,createdAt:new Date(r.createdAt)}}),i(e)}async function c(){return(await n.conversation.findMany({orderBy:{createdAt:"desc"},include:{messages:{orderBy:{createdAt:"asc"}}}})).map(s)}async function p(e,r){return await n.conversation.update({where:{id:e},data:{manualMode:r,...r?{}:{waitingForManual:!1}}}),i(e)}async function l(e,r){return await n.conversation.update({where:{id:e},data:{waitingForManual:r}}),i(e)}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[989,452],()=>t(7248));module.exports=a})();