(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{781:(e,t,a)=>{Promise.resolve().then(a.bind(a,6337))},6337:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>f});var s=a(5155),n=a(2115),l=a(9623),r=a(8633),i=a(3344);let o="huilaai.session",c=async e=>{let t=await fetch(e);if(!t.ok)throw Error("Ошибка загрузки чата");return t.json()};function d(){var e,t,a,r;let[i,d]=(0,n.useState)(null),[h,p]=(0,n.useState)(""),[g,f]=(0,n.useState)(""),[b,v]=(0,n.useState)(!1),[j,w]=(0,n.useState)("idle"),[y,N]=(0,n.useState)(null);(0,n.useEffect)(()=>{d(function(){let e=window.localStorage.getItem(o);return e?JSON.parse(e):null}())},[]);let{data:S,mutate:k}=(0,l.Ay)(i?"/api/conversation/".concat(i.id):null,c,{refreshInterval:i?4e3:0,shouldRetryOnError:!1}),E=null!==(e=null==S?void 0:S.conversation.messages)&&void 0!==e?e:[],C=null!==(t=null==S?void 0:S.conversation.manualMode)&&void 0!==t&&t,M=null!==(a=null==S?void 0:S.conversation.waitingForManual)&&void 0!==a&&a;(0,n.useEffect)(()=>{!i&&(null==S?void 0:S.conversation)&&d({id:S.conversation.id,name:S.conversation.name})},[S,i]),(0,n.useEffect)(()=>{M&&"manual"!==j&&w("manual"),M||"manual"!==j||w("idle")},[M,j]);let O=(0,n.useCallback)(async e=>{e.preventDefault();let t=h.trim();if(!t){N("Введите имя, чтобы начать.");return}try{var a,s;N(null);let e=await fetch("/api/session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t})});if(!e.ok){let t=await e.json();throw Error(null!==(a=t.error)&&void 0!==a?a:"Не удалось создать чат")}let n=await e.json();s=n.conversation,window.localStorage.setItem(o,JSON.stringify(s)),d(n.conversation),p(""),k()}catch(e){N(e instanceof Error?e.message:"Ошибка создания чата")}},[h,k]),I=(0,n.useCallback)(async()=>{if(g.trim()&&i)try{v(!0),w(C?"manual":"typing");let t=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversationId:i.id,message:g.trim()})});if(!t.ok){var e;let a=await t.json();throw Error(null!==(e=a.error)&&void 0!==e?e:"Не удалось отправить сообщение")}let a=await t.json();"ok"===a.status?(await k(),w("idle")):w("manual"),f(""),await k()}catch(e){N(e instanceof Error?e.message:"Ошибка отправки"),w("idle")}finally{v(!1)}},[g,i,k,C]),P=!i;return(0,s.jsxs)("div",{className:"min-h-screen relative overflow-hidden",children:[(0,s.jsx)(x,{}),(0,s.jsxs)("main",{className:"relative z-10 flex flex-col items-center px-4 py-10 md:py-16",children:[(0,s.jsxs)("header",{className:"w-full max-w-5xl mb-10 flex flex-col gap-4 text-center",children:[(0,s.jsx)("p",{className:"text-sm uppercase tracking-[0.4em] text-accentMuted",children:"Личный эксперимент"}),(0,s.jsx)("h1",{className:"text-4xl md:text-6xl font-semibold tracking-tight",children:"HuilaAI"}),(0,s.jsx)("p",{className:"text-base md:text-lg text-gray-300 leading-relaxed",children:"Свободный агрегатор нейросетей без рекламы и регистрации. Просто назовите себя и начните диалог с ИИ — в любой момент админ может незаметно перехватить общение в ручном режиме."})]}),(0,s.jsx)("section",{className:"w-full max-w-5xl",children:(0,s.jsx)("div",{className:"glass-panel relative",children:P?(0,s.jsx)(u,{pendingName:h,onNameChange:p,onSubmit:O,error:y}):(0,s.jsx)(m,{messages:E,prompt:g,setPrompt:f,sendPrompt:I,isSending:b,status:j,name:null!==(r=null==i?void 0:i.name)&&void 0!==r?r:"",waitingManual:M,manualMode:C,error:y,clearError:()=>N(null)})})})]})]})}let x=()=>(0,s.jsxs)("div",{className:"absolute inset-0 bg-gradient-to-br from-night via-graphite to-night",children:[(0,s.jsx)("div",{className:"absolute -top-32 right-0 w-[480px] h-[480px] bg-accent/30 blur-[130px]"}),(0,s.jsx)("div",{className:"absolute bottom-0 left-0 w-[520px] h-[520px] bg-success/20 blur-[160px]"})]}),u=e=>{let{pendingName:t,onNameChange:a,onSubmit:n,error:l}=e;return(0,s.jsxs)("form",{onSubmit:n,className:"flex flex-col gap-6 p-8 md:p-12 text-left",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm uppercase tracking-[0.3em] text-accentMuted",children:"Шаг 1"}),(0,s.jsx)("h2",{className:"text-2xl md:text-3xl font-semibold mt-2",children:"Как к тебе обращаться?"}),(0,s.jsx)("p",{className:"text-gray-400 mt-2",children:"Имя нужно один раз, чтобы персонализировать чат. Никаких логинов и паролей."})]}),(0,s.jsxs)("label",{className:"flex flex-col gap-3",children:[(0,s.jsx)("span",{className:"text-sm text-gray-400",children:"Ваше имя"}),(0,s.jsx)("input",{className:"bg-night/60 border border-white/10 rounded-2xl px-5 py-4 text-lg focus:outline-none focus:ring-2 focus:ring-accent transition-all",value:t,maxLength:32,placeholder:"Например, Саша",onChange:e=>a(e.target.value)})]}),l&&(0,s.jsx)("p",{className:"text-sm text-red-400 bg-red-400/10 border border-red-400/40 rounded-xl px-4 py-3",children:l}),(0,s.jsx)("button",{type:"submit",className:"bg-accent text-white py-4 rounded-2xl text-lg font-medium shadow-glass hover:bg-accentMuted transition",children:"Открыть чат"})]})},m=e=>{let{messages:t,prompt:a,setPrompt:l,sendPrompt:o,isSending:c,status:d,name:x,waitingManual:u,manualMode:m,error:f,clearError:b}=e,v=(0,n.useRef)(null);return(0,n.useEffect)(()=>{var e;null===(e=v.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[t,v]),(0,s.jsxs)("div",{className:"flex flex-col h-[70vh] md:h-[75vh]",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between border-b border-white/5 px-6 py-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-400 uppercase tracking-[0.35em]",children:"СЕССИЯ"}),(0,s.jsx)("p",{className:"text-xl font-semibold mt-1",children:x})]}),(0,s.jsx)(h,{manualMode:m,waitingManual:u})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto px-6 py-6 space-y-4",children:[(0,s.jsx)(r.N,{initial:!1,children:t.map(e=>(0,s.jsx)(i.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.3},children:(0,s.jsx)(p,{message:e})},e.id))}),"typing"===d&&(0,s.jsx)(g,{label:"ИИ печатает ответ...",variant:"ai"}),("manual"===d||u)&&(0,s.jsx)(g,{label:"Ответ готовит человек-оператор...",variant:"manual"}),(0,s.jsx)("div",{ref:v})]}),(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),c||o()},className:"border-t border-white/5 px-6 py-4 flex flex-col gap-3",children:[f&&(0,s.jsxs)("div",{className:"bg-red-400/10 border border-red-400/30 text-red-200 rounded-2xl px-4 py-2 text-sm flex items-center justify-between gap-4",children:[(0,s.jsx)("span",{children:f}),(0,s.jsx)("button",{type:"button",onClick:b,className:"text-red-200 hover:text-white",children:"\xd7"})]}),(0,s.jsx)("textarea",{className:"bg-white/5 rounded-2xl px-4 py-3 min-h-[90px] resize-none focus:outline-none focus:ring-2 focus:ring-accent/60",placeholder:"Спросите что угодно...",value:a,onChange:e=>l(e.target.value),disabled:c}),(0,s.jsx)("button",{type:"submit",disabled:c||!a.trim(),className:"self-end bg-accent hover:bg-accentMuted disabled:opacity-50 disabled:cursor-not-allowed text-white px-6 py-2 rounded-xl transition",children:c?"Отправка...":"Отправить"})]})]})},h=e=>{let{manualMode:t,waitingManual:a}=e;return(0,s.jsx)("span",{className:"px-4 py-2 rounded-full text-sm font-medium ".concat(a?"bg-warning/20 text-warning":t?"bg-accent/20 text-accent":"bg-white/10 text-gray-300"),children:a?"Ручной ответ":t?"Ручной режим":"Авто режим"})},p=e=>{let{message:t}=e,a="user"===t.sender;return(0,s.jsx)("div",{className:"flex ".concat(a?"justify-end":"justify-start"," text-base"),children:(0,s.jsx)("div",{className:"rounded-2xl px-5 py-4 max-w-[85%] leading-relaxed shadow-glass ".concat(a?"bg-accent text-white rounded-br-none":"bg-white/5 text-gray-100 border border-white/5 rounded-bl-none"),children:(0,s.jsx)("p",{className:"whitespace-pre-wrap",children:t.text})})})},g=e=>{let{label:t,variant:a}=e;return(0,s.jsxs)("div",{className:"flex items-center gap-3 text-sm text-gray-400",children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center ".concat("manual"===a?"bg-warning/30":"bg-accent/30"),children:(0,s.jsx)("span",{className:"w-2 h-2 rounded-full bg-white/80 animate-pulse"})}),(0,s.jsx)("p",{children:t})]})};function f(){return(0,s.jsx)(d,{})}}},e=>{var t=t=>e(e.s=t);e.O(0,[472,441,517,358],()=>t(781)),_N_E=e.O()}]);