(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{5116:(e,t,s)=>{Promise.resolve().then(s.bind(s,7929))},7929:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var a=s(5155),n=s(2115),r=s(9623),i=s(8633),l=s(3344);let c=async e=>{let[t,s]=e,a=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:s})});if(!a.ok)throw Error("Неверный пароль");return a.json()};function d(){let[e,t]=(0,n.useState)(""),[s,d]=(0,n.useState)(null),[o,x]=(0,n.useState)(null),[m,h]=(0,n.useState)(""),[u,p]=(0,n.useState)(null),{data:g,mutate:b,isLoading:y}=(0,r.Ay)(s?["/api/admin/conversations",s]:null,c,{refreshInterval:s?4e3:0,shouldRetryOnError:!1}),f=(0,n.useMemo)(()=>{var e;return null!==(e=null==g?void 0:g.conversations)&&void 0!==e?e:[]},[null==g?void 0:g.conversations]),j=(0,n.useMemo)(()=>f.find(e=>e.id===o),[f,o]),w=async s=>{s.preventDefault();try{let s=await fetch("/api/admin/conversations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:e})});if(!s.ok){var a;let e=await s.json();throw Error(null!==(a=e.error)&&void 0!==a?a:"Ошибка входа")}d(e),t(""),p(null),await b()}catch(e){p(e instanceof Error?e.message:"Ошибка входа"),d(null)}},v=async()=>{s&&j&&(await fetch("/api/admin/manual",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:s,conversationId:j.id,enabled:!j.manualMode})}),await b())},N=async()=>{s&&j&&m.trim()&&(await fetch("/api/admin/reply",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:s,conversationId:j.id,text:m.trim()})}),h(""),await b())};return s?(0,a.jsxs)("div",{className:"min-h-screen bg-night p-6 md:p-10",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm uppercase tracking-[0.4em] text-accentMuted",children:"Панель"}),(0,a.jsx)("h1",{className:"text-3xl font-semibold",children:"HuilaAI Admin"})]}),(0,a.jsx)("button",{onClick:()=>{d(null),x(null)},className:"text-sm text-gray-400 hover:text-white",children:"Выйти"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-[280px_1fr] gap-6",children:[(0,a.jsxs)("div",{className:"glass-panel p-4 overflow-y-auto h-[75vh] space-y-3",children:[y&&(0,a.jsx)("p",{className:"text-sm text-gray-400",children:"Загрузка..."}),f.map(e=>(0,a.jsxs)("button",{onClick:()=>x(e.id),className:"w-full text-left px-4 py-3 rounded-2xl border transition ".concat(e.id===o?"border-accent bg-accent/10":"border-transparent bg-white/5"),children:[(0,a.jsx)("p",{className:"font-semibold",children:e.name}),(0,a.jsx)("p",{className:"text-xs text-gray-400",children:new Date(e.createdAt).toLocaleString("ru-RU")}),(0,a.jsxs)("p",{className:"text-xs mt-1 text-gray-500",children:["Сообщений: ",e.messages.length]})]},e.id))]}),(0,a.jsx)("div",{className:"glass-panel p-6 flex flex-col h-[75vh]",children:j?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-400 uppercase tracking-[0.4em]",children:"Пользователь"}),(0,a.jsx)("h2",{className:"text-2xl font-semibold",children:j.name})]}),(0,a.jsx)("button",{onClick:v,className:"px-4 py-2 rounded-2xl text-sm font-medium ".concat(j.manualMode?"bg-warning/30 text-warning":"bg-accent/30 text-accent"),children:j.manualMode?"Выкл. ручной режим":"Вкл. ручной режим"})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto space-y-4 pr-2",children:(0,a.jsx)(i.N,{initial:!1,children:j.messages.map(e=>(0,a.jsxs)(l.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.25},className:"p-4 rounded-2xl border ".concat("user"===e.sender?"border-white/10 bg-white/5":"admin"===e.sender?"border-warning/40 bg-warning/10":"border-accent/40 bg-accent/5"),children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.4em] text-gray-400 mb-2",children:e.sender}),(0,a.jsx)("p",{className:"whitespace-pre-wrap",children:e.text}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-3",children:new Date(e.createdAt).toLocaleTimeString("ru-RU")})]},e.id))})}),(0,a.jsxs)("div",{className:"border-t border-white/5 mt-4 pt-4",children:[(0,a.jsx)("textarea",{value:m,onChange:e=>h(e.target.value),placeholder:"Напишите ответ, который увидит пользователь...",className:"w-full bg-white/5 border border-white/10 rounded-2xl px-4 py-3 min-h-[120px] focus:outline-none focus:ring-2 focus:ring-accent"}),(0,a.jsxs)("div",{className:"flex justify-end mt-3 gap-3",children:[(0,a.jsx)("button",{onClick:()=>h(""),className:"text-sm text-gray-400 hover:text-white",children:"Очистить"}),(0,a.jsx)("button",{onClick:N,disabled:!m.trim(),className:"bg-accent hover:bg-accentMuted disabled:opacity-50 text-white px-5 py-2 rounded-xl transition",children:"Отправить вручную"})]})]})]}):(0,a.jsx)("div",{className:"flex items-center justify-center h-full text-gray-500",children:"Выберите чат слева"})})]})]}):(0,a.jsx)("div",{className:"min-h-screen bg-night flex items-center justify-center px-4",children:(0,a.jsxs)("form",{onSubmit:w,className:"glass-panel max-w-md w-full p-10 space-y-6",children:[(0,a.jsx)("p",{className:"text-sm uppercase tracking-[0.4em] text-accentMuted text-center",children:"Админ вход"}),(0,a.jsx)("h1",{className:"text-3xl font-semibold text-center",children:"HuilaAI"}),(0,a.jsx)("input",{type:"password",autoFocus:!0,value:e,onChange:e=>t(e.target.value),placeholder:"Пароль",className:"w-full bg-white/5 border border-white/10 rounded-2xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-accent"}),u&&(0,a.jsx)("p",{className:"text-center text-red-400 text-sm bg-red-400/10 rounded-xl py-2",children:u}),(0,a.jsx)("button",{type:"submit",className:"w-full bg-accent hover:bg-accentMuted text-white py-3 rounded-2xl transition",children:"Войти"})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[472,441,517,358],()=>t(5116)),_N_E=e.O()}]);